<dom-module id="search-bar">

    <style>
    :host {
        display: none;
    }
    
    :host([active]) {
        display: block;
    }
    
    paper-toolbar {
        --paper-toolbar-background: white;
        --paper-toolbar-color: black;
    }
    
    input {
        background: transparent;
        border: none;
        font-size: 18px;
        padding: 0 12px;
    }
    </style>

    <template>
        <paper-header-panel class="fit" style="background: #EEE; z-index: 1;">
            <paper-toolbar>
                <paper-icon-button icon="arrow-back" on-click="toggle"></paper-icon-button>
                <input class="flex" id="input" on-keyup="search" placeholder="search">
                <paper-icon-button icon="filter-list" on-tap="filter"></paper-icon-button>
            </paper-toolbar>

            <div class="center-justified horizontal layout">
                <div class="li">
                    <div class="bordered cursor-d etc" id="title" style="padding: 16px;">empty</div>

                    <div style="padding: 0 4px;">
                        <paper-progress hidden id="progress" indeterminate style="width: 100%;"></paper-progress>
                    </div>

                    <template as="patent" is="dom-repeat" items="[[list]]">
                        <inbox-item item$="[[patent]]"></inbox-item>
                    </template>

                    <div style="min-height: 80px;"></div>
                </div>
            </div>
        </paper-header-panel>
    </template>

    <script>
    Polymer({

        search: function() {
            this.$.progress.hidden = false;
            this.$.title.textContent = "searching ..";

            this.list = [];

            this.debounce("search", function() {
                this.$.progress.hidden = true;
                this.$.title.textContent = "notFound in input";

                this.list = _patent.find({
                    input: {
                        $regex: this.$.input.value
                    }
                }).fetch();

                if (this.list.length) {
                    this.$.title.textContent = this.list.length + " patent exists";
                }
            }, 1000);
        },

        filter: function() {
            document.querySelector("#polymer_toast").toast("filterNotFound");
        },

        is: "search-bar",

        properties: {
            active: {
                notify: true,
                reflectToAttribute: true,
                type: Boolean,
                value: false
            },
            list: {
                type: Array,
                value: function() {
                    return [];
                }
            }
        },

        toggle: function() {
            this.active = !this.active;

            if (this.active) {
                this.async(function() {
                    this.$.input.focus();
                }, 400);
            }
        }

    });
    </script>

</dom-module>
