<polymer-element attributes="enabled list" name="search-bar">
    <template>
        <style>
        :host {
            display: none;
        }
        
        :host([enabled]) {
            display: block;
        }
        
        core-header-panel {
            background: rgba(238, 238, 238, 0.8);
            margin: 0;
            z-index: 1;
        }
        
        core-toolbar {
            background: white;
        }
        
        core-toolbar paper-icon-button {
            margin: 0!important;
        }
        
        input {
            background: transparent;
            border: none;
            font-size: 16px;
            outline: none;
        }
        </style>

        <core-header-panel fit mode="standard">
            <core-toolbar>
                <paper-icon-button icon="arrow-back" on-tap="{{toggle}}"></paper-icon-button>
                <input flex id="searchInput" placeholder="search ..">
            </core-toolbar>

            <div center-justified horizontal layout>
                <div class="li" style="padding: 16px 8px;">{{list.length ? (list.length + " result" + (list.length == 1 ? "" : "s")) : "empty"}}</div>
            </div>

            <template repeat="{{list}}">
                <div center-justified horizontal layout>
                    <div class="li {{listClass}}" horizontal justified layout on-tap="{{listItemTap}}" tag="{{_id}}">
                        <div class="padding-4" self-start>
                            <selectable-icon iconClass="{{categoryClass}}" iconText="{{linkz.length}}"></selectable-icon>
                        </div>
                        <div class="padding-4" flex layout vertical>
                            <div auto-vertical class="lowercase"><span class="title">{{title}}</span> &nbsp;<b class="description">{{category}}</b></div>
                            <div auto-vertical class="description" horizontal justified layout>
                                <div class="overflow-hidden">{{size}} | <b>{{seeds}}</b> S / <b>{{peers}}</b> P</div>
                                <div class="overflow-hidden">{{fromNow}}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </core-header-panel>
    </template>

    <script>
    Polymer("search-bar", {

        enabled: false,
        list: [],

        listChanged: function() {
            if (!(this.list instanceof Array)) {
                this.list = JSON.parse(this.list);
            }

            // console.log(this.list);
        },

        listItemTap: function(event, detail, sender) {
            var _id = $(sender).attr("tag"),
                index = -1;

            var item = _.find(this.list, function(item) {
                index++;

                return (_id == item._id);
            });

            if (item) {
                document.querySelector("download-linkz").open(this.list[index]);
            }
        },

        publish: {
            enabled: {
                reflect: true,
                value: false
            }
        },

        toggle: function() {
            this.enabled = !this.enabled;

            if (this.enabled) {
                var _this = this;

                Meteor.setTimeout(function() {
                    _this.$.searchInput.focus();
                }, 400);
            }
        }

    });
    </script>
</polymer-element>
