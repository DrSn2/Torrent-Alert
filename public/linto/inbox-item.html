<polymer-element attributes="item selected undo" name="inbox-item">
    <template>
        <style>
        .li {
            padding: 8px;
            width: {{width}}px;
        }
        
        .li.hidden {
            display: none !important;
        }
        
        .li.item {
            background: white;
            border-bottom: 4px solid #EEE;
            cursor: pointer;
        }
        </style>

        <div center-justified horizontal layout on-holdpulse="{{inboxItemHold}}" on-tap="{{inboxItemTap}}" tag="{{_id}}">
            <div class="li item" horizontal justified layout>
                <div class="padding-4" self-start>
                    <selectable-icon iconClass="{{item.categoryClass}}" iconText="{{item.linkz.length}}" id="selectableIcon" selected?="{{selected}}" tag="{{_id}}"></selectable-icon>
                </div>
                <div class="padding-4" flex layout vertical>
                    <div auto-vertical class="lowercase"><span class="title">{{item.title}}</span> &nbsp;<b class="description">{{item.category}}</b></div>
                    <div auto-vertical class="description" horizontal justified layout>
                        <div class="overflow-hidden">{{item.size}} | <b>{{item.seeds}}</b> S / <b>{{item.peers}}</b> P</div>
                        <div class="overflow-hidden">{{item.time}}</div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
    Polymer("inbox-item", {

        holding: false,
        item: {},
        width: 448,

        inboxItemHold: function(event, detail, sender) {
            if (this.holding || event.target == this.$.selectableIcon) {
                return;
            }

            this.selected = !this.selected;
            this.$.selectableIcon.fire("tap");

            this.holding = true;

            var _this = this;

            window.setTimeout(function() {
                _this.holding = false;
            }, 800);
        },

        inboxItemTap: function(event, detail, sender) {
            if (event.target != this.$.selectableIcon) {
                event.stopPropagation();

                document.querySelector("download-linkz").open(this.item);
            }
        },

        itemChanged: function() {
            if (!(this.item instanceof Object)) {
                this.item = JSON.parse(this.item);
            }

            this.item.time = moment(this.item.time, "X").fromNow();

            // console.log(this.item);
        },

        publish: {
            selected: {
                reflect: true,
                value: false
            },
            undo: {
                reflect: true,
                value: false
            }
        }

    });
    </script>
</polymer-element>
