<polymer-element name="download-linkz">
    <template>
        <paper-dialog backdrop opened="{{opened}}" transition="core-transition-bottom">
            <div class="padding-24" layout vertical>
                <template repeat="{{item.linkz}}">
                    <div horizontal layout onclick="window.open('{{url}}', '_system');" style="cursor: pointer; padding: 4px 0;">
                        <div class="padding-4" self-start>
                            <selectable-icon iconClass="{{iconClass}}" iconText="{{iconText}}"></selectable-icon>
                        </div>
                        <div class="padding-4" flex layout vertical>
                            <div auto-vertical class="lowercase"><span class="title">{{text}}</span></div>
                            <div auto-vertical class="description">{{fromNow}}</div>
                        </div>
                    </div>
                </template>
            </div>
        </paper-dialog>
    </template>

    <script>
    Polymer("download-linkz", {

        item: {},
        opened: false,

        open: function(item) {
            if (item.linkz && item.linkz.length) {
                this.item = item;

                this.item.linkz = _.sortBy(this.item.linkz, "time");

                for (var A = 0; A < this.item.linkz.length; A++) {
                    this.item.linkz[A].iconClass = polymer_color(this.item.linkz[A].text);
                    this.item.linkz[A].iconText = isNaN(this.item.linkz[A].text.charAt(0)) ? this.item.linkz[A].text.charAt(0) : "#";

                    this.item.linkz[A].fromNow = moment(this.item.linkz[A].time, "X").fromNow();
                }

                this.opened = true;
            } else {
                if (document.querySelector("html /deep/ inbox-list")) {
                    document.querySelector("html /deep/ inbox-list").toastOpened = false;

                    window.setTimeout(function() {
                        document.querySelector("html /deep/ inbox-list").toastText = "sever still processing it";
                        document.querySelector("html /deep/ inbox-list").toastOpened = true;
                    }, 400);
                }
            }
        }

    });
    </script>
</polymer-element>
