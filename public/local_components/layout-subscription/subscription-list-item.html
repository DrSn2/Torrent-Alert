<dom-module id="subscription-list-item">
  <style>
  paper-icon-item {
    border-bottom: 1px solid #EEE;
    border-top: 1px solid #EEE;
  }
  
  .subhead {
    @apply(--paper-font-subhead);
  }
  </style>

  <template>
    <div class="center-justified horizontal layout">
      <div class="li">
        <paper-icon-item class="cursor-p white" on-tap="_tap">
          <selectable-icon icon_class="[[return_icon_class(item._id)]]" icon_text="[[return_icon_text(item.title)]]" id="selectable_icon" item-icon selected$="{{selected}}"></selectable-icon>

          <paper-item-body two-line>
            <div>[[item.title]]</div>
            <div secondary>[[return_description(item.query)]]</div>
          </paper-item-body>

          <div class="subhead">[[return_count(item.count)]]</div>
        </paper-icon-item>
      </div>
    </div>
  </template>
</dom-module>

<script>
(function() {
  Polymer({

    _tap: function(e) {
      if (Polymer.dom(e).localTarget.id != 'selectable_icon') {
        e.stopPropagation();

        FlowRouter.go("/torrent", {}, {
          previous: Base64.encode(ascii_array(FlowRouter.current().path)),
          project: this.item._id,
          route: null,
        });
      }
    },

    is: 'subscription-list-item',

    return_count: function(count) {
      return number_minify(count, 1);
    },

    return_description: function(query) {
      var quality = (query.match(/\/(.+)\?f=/) ? query.match(/\/(.+)\?f=/)[1].replace(/[^a-z]/g, '') : 'search');

      var quality_map = {
        any: 'All',
        search: 'Good',
        verified: 'Very Good',
      };

      var age = (query.match(/ added<([0-9]+)d ?/) ? +query.match(/ added<([0-9]+)d ?/)[1] : 90);

      var leech = (query.match(/ leech>([0-9]+) ?/) ? +query.match(/ leech>([0-9]+) ?/)[1] : 0);
      var seed = (query.match(/ seed>([0-9]+) ?/) ? +query.match(/ seed>([0-9]+) ?/)[1] : 0);

      return (quality_map[quality] ? quality_map[quality] : '') + (age ? ' | ' + age + 'D' : '') + (leech ? ' | ' + leech + 'L' : '') + (seed ? ' | ' + seed + 'S' : '');
    },

    return_icon_class: function(text) {
      return polymer_color(text ? text : '#');
    },

    return_icon_text: function(text) {
      return (isNaN(text.charAt(0)) ? text.charAt(0) : '#');
    },

  });
})();
</script>
