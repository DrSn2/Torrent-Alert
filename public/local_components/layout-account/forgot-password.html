<dom-module id="forgot-password">
  <style>
  paper-menu {
    min-width: 192px
  }
  
  paper-menu-button {
    padding: 0;
  }
  
  paper-toolbar {
    --paper-toolbar-background: var(--paper-teal-500);
    --paper-toolbar-color: white;
  }
  
  .footer {
    min-height: 88px;
  }
  
  .form {
    padding: 16px;
  }
  </style>

  <template>
    <paper-header-panel mode="seamed">
      <paper-toolbar>
        <paper-icon-button icon="arrow-back" on-tap="_back"></paper-icon-button>
        <div class="title">Forgot Password</div>
        <paper-icon-button icon="done" on-tap="_done"></paper-icon-button>

        <paper-menu-button horizontal-align="right" horizontal-offset="-8">
          <paper-icon-button class="dropdown-trigger" icon="more-vert"></paper-icon-button>

          <paper-menu class="dropdown-content" on-iron-activate="_menu">
            <paper-item class="cursor-p" data-menu="Issue Reporting">Issue Reporting</paper-item>
            <paper-item class="cursor-p" data-menu="New Account">New Account</paper-item>
            <paper-item class="cursor-p" data-menu="Sign In">Sign In</paper-item>
          </paper-menu>
        </paper-menu-button>
      </paper-toolbar>

      <div class="center-justified horizontal layout">
        <div class="li">
          <div class="form layout vertical">
            <gold-email-input auto-validate label="Mail Id" required value="{{email}}"></gold-email-input>
          </div>
        </div>
      </div>

      <div class="footer"></div>
    </paper-header-panel>
  </template>
</dom-module>

<script>
(function() {
  Polymer({

    _back: function() {
      if (FlowRouter.getQueryParam('previous')) {
        FlowRouter.go(array_ascii(Base64.decode(FlowRouter.getQueryParam('previous'))));
      }
    },

    _done: function() {
      document.querySelector("#polymer_modal_spinner").toggle();

      Accounts.forgotPassword({
        email: this.email,
      }, function(error) {
        document.querySelector("#polymer_modal_spinner").toggle();

        if (error) {
          document.querySelector("#polymer_toast").toast(error.message);
        } else {
          document.querySelector("#polymer_toast").toast("reset password url sent @ email");
        }
      });
    },

    _menu: function(e, d) {
      switch (d.item.dataset.menu) {
        case 'New Account':
          FlowRouter.setQueryParams({
            previous: Base64.encode(ascii_array(FlowRouter.current().path)),
            route: 'sign-up',
          });
          break;

        case 'Issue Reporting':
          window.open('//github.com/HedCET/Torrent-Alert/issues', '_system');
          break;

        case 'Sign In':
          FlowRouter.setQueryParams({
            previous: Base64.encode(ascii_array(FlowRouter.current().path)),
            route: 'sign-in',
          });
          break;
      }
    },

    is: "forgot-password",

  });
})();
</script>
